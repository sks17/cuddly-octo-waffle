---
/**
 * VisualCodeLayout - Reusable three-column layout for project and blog pages
 * 
 * Center: Primary visual/interactive content area
 * Left: Similar Projects navigation
 * Right: Similar Blogs + Additional Info sections  
 * Footer: Reused site components
 */

import BaseLayout from './BaseLayout.astro';
import HomepageContact from '../components/HomepageContact.astro';
import PortfolioPreview from '../components/PortfolioPreview.astro';

interface Props {
  title: string;
  description: string;
  publishDate?: Date;
  similarProjects?: Array<{
    id: string;
    title: string;
    description: string;
    img?: string;
    img_alt?: string;
  }>;
  similarBlogs?: Array<{
    id: string;
    title: string;
    description: string;
    publishDate: Date;
  }>;
  additionalInfo?: {
    tags?: string[];
    tech?: string[];
    links?: Array<{ label: string; url: string; }>;
    metadata?: Record<string, string>;
  };
}

const { title, description, publishDate, similarProjects = [], similarBlogs = [], additionalInfo } = Astro.props;
---

<BaseLayout title={title} description={description}>
  <div class="visual-code-layout">
    <!-- Main Three-Column Container -->
    <div class="layout-grid">
      
      <!-- Left Column: Similar Projects -->
      <aside class="sidebar-left">
        <section class="similar-section">
          <h3>Similar Projects</h3>
          {similarProjects.length > 0 ? (
            <div class="similar-list">
              {similarProjects.slice(0, 4).map(project => (
                <a href={`/work/${project.id}`} class="similar-item">
                  <div class="similar-content">
                    <h4>{project.title}</h4>
                    <p>{project.description}</p>
                  </div>
                </a>
              ))}
            </div>
          ) : (
            <p class="empty-state">No related projects available</p>
          )}
        </section>
      </aside>

      <!-- Center: Primary Visual Content -->
      <main class="visual-content">
        <header class="content-header">
          <h1>{title}</h1>
          {publishDate && (
            <time class="publish-date">
              {publishDate.toLocaleDateString('en-US', { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
              })}
            </time>
          )}
        </header>
        
        <!-- Main visual/interactive content area -->
        <div class="visual-container">
          <slot />
        </div>
      </main>

      <!-- Right Column: Blogs + Additional Info -->
      <aside class="sidebar-right">
        <!-- Similar Blogs Section -->
        <section class="similar-section">
          <h3>Similar Blogs</h3>
          {similarBlogs.length > 0 ? (
            <div class="similar-list">
              {similarBlogs.slice(0, 3).map(blog => (
                <a href={`/blogs/${blog.id}`} class="similar-item">
                  <div class="similar-content">
                    <h4>{blog.title}</h4>
                    <p>{blog.description}</p>
                    <time class="item-date">
                      {blog.publishDate.toLocaleDateString('en-US', { 
                        month: 'short', 
                        day: 'numeric' 
                      })}
                    </time>
                  </div>
                </a>
              ))}
            </div>
          ) : (
            <p class="empty-state">No related blogs available</p>
          )}
        </section>

        <!-- Additional Info Section -->
        {additionalInfo && (
          <section class="additional-info">
            <h3>Additional Info</h3>
            
            {additionalInfo.tags && (
              <div class="info-group">
                <h4>Tags</h4>
                <div class="tag-list">
                  {additionalInfo.tags.map(tag => (
                    <span class="tag">{tag}</span>
                  ))}
                </div>
              </div>
            )}

            {additionalInfo.tech && (
              <div class="info-group">
                <h4>Technologies</h4>
                <div class="tech-list">
                  {additionalInfo.tech.map(tech => (
                    <span class="tech">{tech}</span>
                  ))}
                </div>
              </div>
            )}

            {additionalInfo.links && (
              <div class="info-group">
                <h4>Links</h4>
                <div class="link-list">
                  {additionalInfo.links.map(link => (
                    <a href={link.url} target="_blank" rel="noopener" class="info-link">
                      {link.label}
                    </a>
                  ))}
                </div>
              </div>
            )}

            {additionalInfo.metadata && (
              <div class="info-group">
                <h4>Details</h4>
                <dl class="metadata-list">
                  {Object.entries(additionalInfo.metadata).map(([key, value]) => (
                    <div class="metadata-item">
                      <dt>{key}</dt>
                      <dd>{value}</dd>
                    </div>
                  ))}
                </dl>
              </div>
            )}
          </section>
        )}
      </aside>
    </div>
  </div>

  <!-- Reused Footer Components -->
  <HomepageContact />
</BaseLayout>

<style>
  .visual-code-layout {
    min-height: 100vh;
    padding: 0 1rem 2rem;
  }

  .layout-grid {
    display: grid;
    grid-template-columns: 220px 1fr 220px;
    gap: 2rem;
    max-width: 1400px;
    margin: 0 auto;
    align-items: start;
  }

  /* Center Column - Primary Focus */
  .visual-content {
    min-height: 70vh;
    background: var(--gray-999);
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
  }

  .content-header {
    padding: 2rem;
    background: linear-gradient(135deg, var(--accent-regular), var(--accent-dark));
    color: var(--accent-text-over);
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
  }

  .content-header h1 {
    margin: 0 0 0.5rem 0;
    font-size: var(--text-3xl);
    font-weight: 700;
    line-height: 1.2;
  }

  .publish-date {
    font-size: var(--text-sm);
    opacity: 0.8;
    font-weight: 500;
  }

  .visual-container {
    padding: 2rem;
    min-height: 500px;
    background: var(--gray-0);
    color: var(--gray-800);
  }

  /* Sidebar Styling */
  .sidebar-left,
  .sidebar-right {
    display: flex;
    flex-direction: column;
    gap: 2rem;
  }

  .similar-section,
  .additional-info {
    background: rgba(255, 255, 255, 0.02);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 8px;
    padding: 1.5rem;
  }

  .similar-section h3,
  .additional-info h3 {
    margin: 0 0 1rem 0;
    font-size: var(--text-lg);
    font-weight: 600;
    color: var(--gray-0);
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    padding-bottom: 0.5rem;
  }

  /* Similar Items */
  .similar-list {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  .similar-item {
    display: block;
    padding: 1rem;
    background: rgba(255, 255, 255, 0.02);
    border: 1px solid rgba(255, 255, 255, 0.05);
    border-radius: 6px;
    text-decoration: none;
    color: inherit;
    transition: all 0.3s ease;
  }

  .similar-item:hover {
    background: rgba(255, 255, 255, 0.05);
    border-color: var(--accent-regular);
    transform: translateY(-1px);
  }

  .similar-content h4 {
    margin: 0 0 0.5rem 0;
    font-size: var(--text-base);
    font-weight: 600;
    color: var(--gray-0);
    line-height: 1.3;
  }

  .similar-content p {
    margin: 0;
    font-size: var(--text-sm);
    color: var(--gray-300);
    line-height: 1.4;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .item-date {
    margin-top: 0.5rem;
    font-size: var(--text-xs);
    color: var(--accent-regular);
    font-weight: 500;
  }

  .empty-state {
    color: var(--gray-400);
    font-style: italic;
    font-size: var(--text-sm);
    text-align: center;
    padding: 1rem;
  }

  /* Additional Info Styling */
  .info-group {
    margin-bottom: 1.5rem;
  }

  .info-group:last-child {
    margin-bottom: 0;
  }

  .info-group h4 {
    margin: 0 0 0.75rem 0;
    font-size: var(--text-base);
    font-weight: 600;
    color: var(--gray-100);
  }

  .tag-list,
  .tech-list {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
  }

  .tag,
  .tech {
    padding: 0.25rem 0.75rem;
    background: var(--accent-regular);
    color: var(--accent-text-over);
    border-radius: 12px;
    font-size: var(--text-xs);
    font-weight: 500;
  }

  .tech {
    background: rgba(255, 255, 255, 0.1);
    color: var(--gray-200);
  }

  .link-list {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  .info-link {
    color: var(--accent-regular);
    text-decoration: none;
    font-size: var(--text-sm);
    transition: color 0.3s ease;
  }

  .info-link:hover {
    color: var(--accent-light);
    text-decoration: underline;
  }

  .metadata-list {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  .metadata-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.5rem 0;
    border-bottom: 1px solid rgba(255, 255, 255, 0.05);
  }

  .metadata-item:last-child {
    border-bottom: none;
  }

  .metadata-item dt {
    font-size: var(--text-sm);
    color: var(--gray-300);
    font-weight: 500;
  }

  .metadata-item dd {
    margin: 0;
    font-size: var(--text-sm);
    color: var(--gray-100);
  }

  /* Responsive Design */
  @media (max-width: 1200px) {
    .layout-grid {
      grid-template-columns: 200px 1fr 200px;
      gap: 1.5rem;
    }
  }

  @media (max-width: 900px) {
    .layout-grid {
      grid-template-columns: 1fr;
      gap: 2rem;
    }
    
    .sidebar-left,
    .sidebar-right {
      flex-direction: row;
      gap: 2rem;
    }
    
    .similar-section,
    .additional-info {
      flex: 1;
    }
  }

  @media (max-width: 600px) {
    .visual-code-layout {
      padding: 0.5rem 1rem 2rem;
    }
    
    .sidebar-left,
    .sidebar-right {
      flex-direction: column;
    }
    
    .content-header {
      padding: 1.5rem;
    }
    
    .visual-container {
      padding: 1.5rem;
    }
  }
</style>