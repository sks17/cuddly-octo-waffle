---
import { getRegistryProjects } from '../data/projectRegistry';
// Component Imports
import CallToAction from '../components/CallToAction.astro';
import HomepageContact from '../components/HomepageContact.astro';
// Page section components
import Hero from '../components/Hero.astro';
import Icon from '../components/Icon.astro';
import Pill from '../components/Pill.astro';
import ProjectSection from '../components/ProjectSection.astro';
import BackgroundGenerator from '../components/BackgroundGenerator.astro';
// Layout import — provides basic page elements: <head>, <nav>, <footer> etc.
import BaseLayout from '../layouts/BaseLayout.astro';

// Use project registry instead of markdown content
const projects = getRegistryProjects();

// Full Astro Component Syntax:
// https://docs.astro.build/basics/astro-components/
---

<BaseLayout>
	<div class="stack gap-20 lg:gap-32">
		<div class="wrapper stack gap-8 lg:gap-20">
			<header class="hero" id="hero-section">
				<BackgroundGenerator />
				
				<Hero
					title="Hello..."
					tagline="> My name is Saksham Singh, and I am a student at the University of Washington pursuing a bachelor's degree in computer science, with minors in mathematics, data science, and finance. I've always been interested in mathematics and science as ways to model systems, reason, and explore."
					align="center"
					titleAttrs={{ 'data-type-speed': '90', 'data-type-delay': '0' }}
					taglineAttrs={{ 'data-type-speed': '12', 'data-type-delay': '900' }}
				>
					<div class="roles" data-fade-in-delay="4000">
						<Pill>&gt; SinghDevs</Pill>
						<Pill>&gt; SinghLearns</Pill>
						<Pill>&gt; SinghParlays</Pill>
					</div>
				</Hero>

			</header>

		</div>

		<main id="main-content">
			<section class="work-section-wrapper scroll-reveal-section" id="selected-work">
				<header class="work-header">
					<h2 class="work-title">Selected Work</h2>
					<p class="work-tagline">Selected work — scroll to explore</p>
				</header>

				<div class="projects-container">
					{
						projects.map((project, index) => (
							<ProjectSection project={project} index={index} />
						))
					}
				</div>

				<div class="work-cta">
					<CallToAction href="/work/">
						View All Projects
						<Icon icon="arrow-right" size="1.2em" />
					</CallToAction>
				</div>
			</section>

		</main>

		<HomepageContact />
	</div>

	<script>
		import { initTextAppearance, onTextAnimationComplete } from '../scripts/textAppearance';
		import { initSelectedWorkOverlay } from '../scripts/selectedWorkOverlay';
		import { initProjectFocus } from '../scripts/projectFocus';
		import { initHeroTransition } from '../scripts/heroTransition';
		import { initHeroBackground } from '../scripts/heroBackground';

		document.addEventListener('DOMContentLoaded', () => {
			initTextAppearance();
			initSelectedWorkOverlay();
			initProjectFocus();

			// When text animation completes, transition hero and add mathematical background
			onTextAnimationComplete(() => {
				// Small delay for smoother transition after typewriter
				setTimeout(() => {
					initHeroTransition();
					initHeroBackground();
				}, 600);
			});
		});
	</script>
</BaseLayout>

<style>
	.hero {
		position: relative;
		display: flex;
		flex-direction: column;
		align-items: center;
		gap: 2rem;
	}

	:global(.hero .tagline) {
		max-width: none;
		width: 100%;
		margin: 0;
		text-align: left;
	}

	/* Increase spacing above pills section */
	.roles {
		margin-top: 3rem;
	}

	.roles {
		display: none;
	}

	.hero img {
		aspect-ratio: 5 / 4;
		object-fit: cover;
		object-position: top;
		border-radius: 1.5rem;
		box-shadow: var(--shadow-md);
	}

	@media (min-width: 50em) {
		.hero {
			display: grid;
			grid-template-columns: 1fr;
			justify-items: center;
			text-align: center;
			padding-inline: 2.5rem;
			gap: 3.75rem;
		}

		.roles {
			margin-top: 0.5rem;
			display: flex;
			gap: 0.5rem;
		}

		.hero img {
			aspect-ratio: 3 / 4;
			border-radius: 4.5rem;
			object-fit: cover;
		}
	}

	/* ====================================================== */

	/* Selected Work Section - Full-width immersive layout */
	#main-content {
		position: relative;
		width: 100%;
		margin-top: 4rem;
	}

	.work-section-wrapper {
		position: relative;
		width: 100%;
		min-height: auto;
	}

	.work-header {
		text-align: center;
		padding: 4rem 2rem 2rem;
		max-width: 60rem;
		margin: 0 auto;
	}

	.work-title {
		font-family: var(--font-brand);
		font-size: var(--text-4xl);
		font-weight: 600;
		color: var(--gray-0);
		margin: 0 0 1rem;
		letter-spacing: -0.025em;
	}

	.work-tagline {
		font-size: var(--text-lg);
		color: var(--gray-300);
		margin: 0;
		font-style: italic;
	}

	.projects-container {
		position: relative;
		width: 100%;
		height: 100vh;
		/* scroll-snap disabled - JS handles discrete navigation */
		overflow-y: scroll;
		overflow-x: hidden;
		scrollbar-width: none;
		-ms-overflow-style: none;
		-webkit-overflow-scrolling: touch;
		
		/* Lock colors to dark theme values regardless of light/dark mode */
		--gray-0: #090b11;
		--gray-50: #141925;
		--gray-100: #222939;
		--gray-200: #303a51;
		--gray-300: #3e4b69;
		--gray-400: #4c5b81;
		--gray-500: #5a6c99;
		--gray-600: #697db1;
		--gray-700: #778ec9;
		--gray-800: #859ee1;
		--gray-900: #93aff9;
		--gray-999-basis: 0, 0%, 100%;
		--gray-999_40: hsla(var(--gray-999-basis), 0.4);
		--gray-999: #ffffff;
	}

	.projects-container::-webkit-scrollbar {
		display: none;
	}

	.work-cta {
		text-align: center;
		padding: 4rem 2rem;
		background: linear-gradient(180deg, transparent 0%, var(--gray-999) 50%);
	}

	@media (min-width: 50em) {
		.work-title {
			font-size: var(--text-5xl);
		}

		.work-tagline {
			font-size: var(--text-xl);
		}

		.work-header {
			padding: 6rem 2rem 3rem;
		}
	}

	/* ====================================================== */

	/* Scroll-Triggered Section Reveal */
	.scroll-reveal-section {
		position: relative;
	}

	.scroll-reveal-section::after {
		content: '';
		position: absolute;
		left: 50%;
		transform: translateX(-50%);
		width: 100vw;
		top: 0;
		bottom: 0;
		background: var(--accent-dark);
		opacity: var(--reveal-overlay-opacity, 1);
		pointer-events: none;
		z-index: 10;
	}

	/* Spotlight effect: dim everything except focused project when in locked mode */
	.scroll-reveal-section.spotlight-active .work-header {
		opacity: 0.3;
		filter: blur(2px);
		transition: opacity 0.4s ease, filter 0.4s ease;
	}

	.scroll-reveal-section.spotlight-active .work-cta {
		opacity: 0.3;
		filter: blur(2px);
		transition: opacity 0.4s ease, filter 0.4s ease;
	}

	/* ============================================================ */
	/* MOBILE OPTIMIZATIONS - Homepage specific                    */
	/* ============================================================ */
	
	@media (max-width: 49.9em) {
		.work-header {
			padding: 3rem 1rem 2rem;
		}

		.work-title {
			font-size: var(--text-3xl);
			margin: 0 0 0.75rem;
		}

		.work-tagline {
			font-size: var(--text-base);
		}

		/* Projects container: Allow natural scrolling on mobile */
		.projects-container {
			height: auto;
			overflow-y: visible;
			overflow-x: hidden;
		}

		.work-cta {
			padding: 2rem 1rem;
		}

		/* Disable spotlight effect on mobile for simpler UX */
		.scroll-reveal-section.spotlight-active .work-header,
		.scroll-reveal-section.spotlight-active .work-cta {
			opacity: 1;
			filter: none;
		}
	}

	/* Reduce motion for accessibility */
	@media (prefers-reduced-motion: reduce) {
		.project-section,
		.scroll-reveal-section.spotlight-active .work-header,
		.scroll-reveal-section.spotlight-active .work-cta {
			transition: none !important;
		}
	}

	/* ====================================================== */
	/* Contact section styles now in HomepageContact component */
</style>
