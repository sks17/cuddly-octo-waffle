---
import { type CollectionEntry, getCollection, render } from 'astro:content';
import VisualCodeLayout from '../../layouts/VisualCodeLayout.astro';
import { getRegistryProjects, getProjectById } from '../../data/projectRegistry';

interface Props {
	entry: CollectionEntry<'work'>;
}

export async function getStaticPaths() {
	const work = await getCollection('work');
	
	return work.map((entry) => {
		// Find corresponding registry project for additional data
		const registryProject = getProjectById(entry.id);
		
		// TODO: Implement actual similar content logic later
		// Placeholder data for now
		const similarProjects = [];
		const similarBlogs = [];
		
		return {
			params: { slug: entry.id },
			props: { 
				entry, 
				registryProject,
				similarProjects,
				similarBlogs
			},
		};
	});
}

const { entry, registryProject, similarProjects, similarBlogs } = Astro.props;
const { Content } = await render(entry);

// Prepare additional info from registry project
const additionalInfo = registryProject ? {
	tags: registryProject.tags || entry.data.tags,
	tech: [], // TODO: Add tech stack to registry
	links: [], // TODO: Add project links to registry
	metadata: {
		'Published': entry.data.publishDate.toLocaleDateString(),
		'Theme': registryProject.colorTheme,
		'Type': 'Project'
	}
} : undefined;
---

<VisualCodeLayout 
	title={entry.data.title}
	description={entry.data.description}
	publishDate={entry.data.publishDate}
	similarProjects={similarProjects}
	similarBlogs={similarBlogs}
	additionalInfo={additionalInfo}
>
	<!-- Main visual content area -->
	{entry.data.img && (
		<div class="project-image">
			<img src={entry.data.img} alt={entry.data.img_alt || entry.data.title} />
		</div>
	)}
	
	<!-- Markdown content -->
	<div class="project-content">
		<Content />
	</div>
</VisualCodeLayout>

<style>
	.project-image {
		margin-bottom: 2rem;
	}

	.project-image img {
		width: 100%;
		height: auto;
		border-radius: 8px;
		box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
	}

	.project-content {
		line-height: 1.6;
	}

	.project-content :global(h2) {
		margin-top: 2rem;
		margin-bottom: 1rem;
		color: var(--gray-800);
		font-size: var(--text-xl);
	}

	.project-content :global(h3) {
		margin-top: 1.5rem;
		margin-bottom: 0.75rem;
		color: var(--gray-700);
		font-size: var(--text-lg);
	}

	.project-content :global(p) {
		margin-bottom: 1rem;
		color: var(--gray-600);
	}

	.project-content :global(ul),
	.project-content :global(ol) {
		margin-bottom: 1rem;
		padding-left: 1.5rem;
		color: var(--gray-600);
	}

	.project-content :global(li) {
		margin-bottom: 0.5rem;
	}

	.project-content :global(code) {
		background: var(--gray-100);
		padding: 0.125rem 0.25rem;
		border-radius: 3px;
		font-family: monospace;
		font-size: 0.875em;
	}

	.project-content :global(pre) {
		background: var(--gray-100);
		padding: 1rem;
		border-radius: 6px;
		overflow-x: auto;
		margin: 1rem 0;
	}

	.project-content :global(pre code) {
		background: none;
		padding: 0;
	}
</style>
